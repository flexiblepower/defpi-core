{"version":3,"sources":["../../../../../src/javascripts/ng-admin/Crud/delete/DeleteController.js"],"names":["DeleteController","$scope","$window","$state","$q","$translate","WriteQueries","Configuration","progression","notification","params","view","entry","HttpErrorService","config","entityLabel","entity","entityId","id","title","description","actions","getEntity","$on","destroy","bind","previousStateParametersDeferred","defer","event","to","toParams","from","fromParams","resolve","$event","Promise","reject","entityName","name","start","promise","then","previousStateParameters","fromState","toState","get","deleteOne","go","back","log","text","addnCls","catch","done","handleError","error","history","undefined","$inject"],"mappings":"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","file":"DeleteController.js","sourcesContent":["export default class DeleteController {\n    constructor($scope, $window, $state, $q, $translate, WriteQueries, Configuration, progression, notification, params, view, entry, HttpErrorService) {\n        this.$scope = $scope;\n        this.$window = $window;\n        this.$state = $state;\n        this.$translate = $translate;\n        this.WriteQueries = WriteQueries;\n        this.config = Configuration();\n        this.entityLabel = params.entity;\n        this.entityId = params.id;\n        this.view = view;\n        this.title = view.title();\n        this.description = view.description();\n        this.actions = view.actions();\n        this.entity = view.getEntity();\n        this.progression = progression;\n        this.notification = notification;\n        this.$scope.entry = entry;\n        this.$scope.view = view;\n        this.HttpErrorService = HttpErrorService;\n\n        $scope.$on('$destroy', this.destroy.bind(this));\n\n        this.previousStateParametersDeferred = $q.defer();\n        $scope.$on('$stateChangeSuccess', (event, to, toParams, from, fromParams) => {\n            this.previousStateParametersDeferred.resolve(fromParams);\n        });\n    }\n\n    deleteOne($event) {\n        return new Promise((resolve, reject) => {\n            const entityName = this.entity.name();\n            const { $translate, notification, progression } = this;\n            progression.start();\n\n            this.previousStateParametersDeferred.promise\n                .then((previousStateParameters) => {\n                    const fromState = 'delete';\n                    const fromParams = previousStateParameters;\n                    let toState;\n                    let toParams;\n\n                    // if previous page was related to deleted entity,\n                    // redirect to list\n                    if (fromParams.entity === entityName &&\n                        fromParams.id === this.entityId) {\n                            toState = this.$state.get('list');\n                            toParams = {\n                                entity: entityName,\n                                ...this.$state.params,\n                            };\n                    }\n\n                    return this.WriteQueries.deleteOne(this.view, this.entityId)\n                        .then(() => {\n                            if(toState){\n                                return this.$state.go(toState, toParams);\n                            }\n                            return this.back();\n                        })\n                        .then(() => $translate('DELETE_SUCCESS'))\n                        .then(text => notification.log(text, { addnCls: 'humane-flatty-success' }))\n                        .then(() => {\n                            resolve();\n                        })\n                        .catch(error => {\n                            progression.done();\n                            this.HttpErrorService.handleError($event, toState, toParams, fromState, fromParams, error);\n                            reject();\n                        });\n                });\n        });\n    }\n\n    back() {\n        this.$window.history.back();\n    }\n\n    destroy() {\n        this.$scope = undefined;\n        this.$window = undefined;\n        this.$state = undefined;\n        this.$translate = undefined;\n        this.WriteQueries = undefined;\n        this.view = undefined;\n        this.entity = undefined;\n        this.progression = undefined;\n        this.notification = undefined;\n    }\n}\n\nDeleteController.$inject = ['$scope', '$window', '$state', '$q', '$translate', 'WriteQueries', 'NgAdminConfiguration', 'progression', 'notification', 'params', 'view', 'entry', 'HttpErrorService'];\n"]}