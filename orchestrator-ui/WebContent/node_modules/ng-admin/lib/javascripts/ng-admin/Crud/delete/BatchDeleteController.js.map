{"version":3,"sources":["../../../../../src/javascripts/ng-admin/Crud/delete/BatchDeleteController.js"],"names":["BatchDeleteController","$scope","$state","$translate","WriteQueries","progression","notification","view","HttpErrorService","entity","getEntity","entityIds","params","ids","selection","title","description","actions","loadingPage","fields","$on","destroy","bind","$event","entityName","name","fromState","current","fromParams","toState","get","toParams","start","batchDelete","then","go","log","text","addnCls","catch","done","handleError","error","angular","extend","undefined","$inject"],"mappings":"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","file":"BatchDeleteController.js","sourcesContent":["export default class BatchDeleteController {\n    constructor($scope, $state, $translate, WriteQueries, progression, notification, view, HttpErrorService) {\n        this.$scope = $scope;\n        this.$state = $state;\n        this.$translate = $translate;\n        this.WriteQueries = WriteQueries;\n        this.progression = progression;\n        this.notification = notification;\n        this.view = view;\n        this.entity = view.getEntity();\n        this.entityIds = $state.params.ids;\n        this.selection = []; // fixme: query db to get selection\n        this.title = view.title();\n        this.description = view.description();\n        this.actions = view.actions();\n        this.loadingPage = false;\n        this.fields = view.fields();\n        this.HttpErrorService = HttpErrorService;\n\n        $scope.$on('$destroy', this.destroy.bind(this));\n    }\n\n    batchDelete($event) {\n        const entityName = this.entity.name();\n        const { $translate, $state, progression, notification } = this;\n        const fromState = $state.current.name;\n        const fromParams = $state.current.params;\n        const toState = $state.get('list');\n        const toParams = {\n            entity: entityName,\n            ...$state.params,\n        };\n        progression.start();\n        return this.WriteQueries.batchDelete(this.view, this.entityIds)\n            .then(() => $state.go(toState, toParams))\n            // no need to call progression.done() in case of success, as it's called by the view dislayed afterwards\n            .then(() => $translate('BATCH_DELETE_SUCCESS'))\n            .then(text => notification.log(text, { addnCls: 'humane-flatty-success' }))\n            .catch(error => {\n                progression.done();\n                this.HttpErrorService.handleError($event, toState, toParams, fromState, fromParams, error);\n            });\n    }\n\n    back() {\n        this.$state.go(this.$state.get('list'), angular.extend({\n            entity: this.entity.name()\n        }, this.$state.params));\n    }\n\n    destroy() {\n        this.$scope = undefined;\n        this.$state = undefined;\n        this.$translate = undefined;\n        this.WriteQueries = undefined;\n        this.progression = undefined;\n        this.notification = undefined;\n    }\n}\n\nBatchDeleteController.$inject = ['$scope', '$state', '$translate', 'WriteQueries', 'progression', 'notification', 'view', 'HttpErrorService'];\n"]}