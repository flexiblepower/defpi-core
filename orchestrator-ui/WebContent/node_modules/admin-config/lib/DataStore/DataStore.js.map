{"version":3,"sources":["../../src/DataStore/DataStore.js"],"names":[],"mappings":"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","file":"DataStore.js","sourcesContent":["class DataStore {\n    constructor() {\n        this._entries = {};\n    }\n\n    setEntries(name, entries) {\n        this._entries[name] = entries;\n\n        return this;\n    }\n\n    addEntry(name, entry) {\n        if (!(name in this._entries)) {\n            this._entries[name] = [];\n        }\n\n        this._entries[name].push(entry);\n    }\n\n    getEntries(name) {\n        return this._entries[name] || [];\n    }\n\n    /**\n     * Get first entry satisfying a filter function\n     *\n     * @example datastore.getEntry('books', book => book.title === 'War and Peace');\n     */\n    getFirstEntry(name, filter = () => true) {\n        return this.getEntries(name)\n            .filter(filter)\n            .shift();\n    }\n\n    getChoices(field) {\n        let identifier = field.targetEntity().identifier().name();\n        let name = field.targetField().name();\n\n        return this.getEntries(field.targetEntity().uniqueId + '_choices').map(function(entry) {\n            return {\n                value: entry.values[identifier],\n                label: entry.values[name]\n            };\n        });\n    }\n\n    fillReferencesValuesFromCollection(collection, referencedValues, fillSimpleReference) {\n        fillSimpleReference = typeof (fillSimpleReference) === 'undefined' ? false : fillSimpleReference;\n\n        for (let i = 0, l = collection.length; i < l; i++) {\n            collection[i] = this.fillReferencesValuesFromEntry(collection[i], referencedValues, fillSimpleReference);\n        }\n\n        return collection;\n    }\n\n    fillReferencesValuesFromEntry(entry, referencedValues, fillSimpleReference) {\n        for (let referenceField in referencedValues) {\n            let reference = referencedValues[referenceField],\n                choices = this.getReferenceChoicesById(reference),\n                entries = [],\n                identifier = reference.getMappedValue(entry.values[referenceField], entry.values);\n\n            if (reference.type() === 'reference_many') {\n                for (let i in identifier) {\n                    let id = identifier[i];\n                    entries.push(choices[id]);\n                }\n\n                entry.listValues[referenceField] = entries;\n            } else if (fillSimpleReference && identifier != null && identifier in choices) {\n                entry.listValues[referenceField] = reference.getMappedValue(choices[identifier], entry.values);\n            }\n        }\n\n        return entry;\n    }\n\n    getReferenceChoicesById(field) {\n        let result = {},\n            targetField = field.targetField().name(),\n            targetIdentifier = field.targetEntity().identifier().name(),\n            entries = this.getEntries(field.targetEntity().uniqueId + '_values');\n\n        for (let i = 0, l = entries.length ; i < l ; i++) {\n            let entry = entries[i];\n            result[entry.values[targetIdentifier]] = entry.values[targetField];\n        }\n\n        return result;\n    }\n}\n\nexport default DataStore;\n"]}